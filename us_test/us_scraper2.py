# === File: sweden/scraper_yahoo.py ===

import yfinance as yf
import pandas as pd
import sqlite3
from datetime import datetime, timedelta
import os

# === CONFIG ===
DB_PATH = "data/us_equities.db"
TICKERS = [
"API","SSBK","GIG","BGR","VPG","WOW","DMAA","VSTA","ARQQ","IOCJY","ZH","BKSY","TCI","ZEUS","FOF","AWP","AIP","SPIR","CIVB","LSAK","HOND","SOUL","MTA","ARDC","HPF","HIVE","ORN","MSB","MTRX","CCIR","EBS","SPOK","NFGC","VREX","TATT","NREF","AQST","EIC","NVEC","MOV","FNBT","BRW","SNDL","AEHR","SATL","TBN","TERN","CHPT","NL","ALMS","VACH","CMPX","HYAC","CLPT","OIS","BEAG","ALLT","JELD","ACCO","EFT","EDD","CRVS","LAR","AZ","WTBA","USCB","UIS","OCGN","FINS","CUB","SOHU","SMC","BFZ","ASG","NGS","BGT","MIY","MTLS","ATXS","NNOX","AMBI","SIMA","EWCZ","FLWS","MLAC","ACB","WTI","HDSN","BBCP","OFLX","XNET","BLDE","MEI","RCKT","MNTK","FERA","HVT","ABEO","LXFR","CGC","RCS","SLDP","GSRT","CLBR","CPZ","LOCO","AII","ALDF","PDLB","OBT","CDTX","SZZL","KLTR","SJT","NNDM","SIFY","JOUT","VSTM","RXT","HSHP","GEVO","CAN","UROY","AMBC","GCL","BRBS","ODV","PANL","OILSF","RFMZ","NPCT","SPXX","NCV","ESEA","IMXI","QSI","BGH","HRZN","MIN","RITR","LOKV","RMNI","OPRT","ATII","SKBL","ONIT","LZM","LPBB","LPAA","TG","CVEO","CIX","GRAF","CHAC","ZYBT","MCFT","PACK","AACB","TKNO","MEC","MAMA","RBB","NRDY","RAC","HRTX","LVRO","EAF","LTBR","ANVI","FSBW","OMSE","DBL","REFI","SFST","FC","AFB","MHN","ALLO","JGH","HWAIF","NBH","TPVG","NYXH","BCML","SLSN","RHLD","PBFS","PMO","RNGR","LANV","ABXXF","ZTR","DVS","GWRS","HFRO","TRDA","WEYS","PDYN","JPI","AMCX","NECB","XOMA","RM","STRZ","AVNW","SDA","WRN","ITRG","ZDCAF","PAMT","NGNE","INR","BLZE","ANTA","AIRS","MNDR","GHI","LMNR","NCA","UNTC","TRVG","FNKO","BWFG","TEI","FLX","MMD","LEGT","PVLA","WALD","INV","GOSS","ANNX","DMRC","PRTA","JOF","AMRN","ACRE","EPSM","VREOF","AVIR","BYM","NEON","MVIS","OIA","VNDA","TTSH","CZFS","FNLC","AUDC","NATR","MGMNF","NC","HYI","CBAN","QUAD","HCAT","NMG","XHG","OPRX","PAYS","JRVR","RMR","VMD","MVBF","TWN","RMM","CURI","LE","RNAC","EMX","ARAI","IIF","MCR","PMM","HVII","AGD","NEWP","RYAM","BIOX","TBCH","ERC","NEN","OACC","RMAX","KGEI","ASUR","FTF","LNKB","KG","WSBF","MASS","INZY","MMT","FCT","AIRJ","SMTI","CERS","CTGO","HLXB","ZIMV","EOT","LXRX","NBTX","CEPO","TTEC","DBVT","NODK","CMDB","COOK","TDF","LOVE","RLTY","STIM","LAW","PKOH","SEG","DOUG","ABIT","JCE","SATX","CRDF","LPRO","ONEW","MXF","SCGY","FET","BYND","BKT","OZ","SNFCA","SLN","NIU","JMSB","FHTX","PCYO","GASS","KOPN","NUW","FRST","BRVMF","DAAQ","HAWEL","FOA","MERC","ADUR","BZAI","PNRG","MG","TSBK","ATNI","DRDB","RLEA","AREN","COPL","RYET","QTRX","MBCN","BRY","EGHT","FDBC","MXCT","JAKK","HMST","TIL","TSI","TNXP","HBB","HSTXF","NHS","RAAQ","STRT","EVI","AARD","ESPR","NCZ","CDZI","BNY","FGPR","TCMD","MRRDF","SSP","ZJK","SPPP","CAF","TVGN","KNOP","BSEM","III","CATX","PINE","PKBK","DDD","ACV","LIEN","CHMG","WRLGF","ONTF","GMGI","TOI","WEWA","PMX","VUZI","ILPT","LPA","GLO","MACI","IVCBF","IHRT","TDAC","EOD","GNFT","ARL","JRS","FLYX","OSUR","FUND","FENC","PWOD","SUGRF","GCO","FBLA","TCX","SVCC","MDWD","WILC","OVLY","ISSC","FXE","OABI","RR","CPSS","DSGN","MITT","BDMD","FVR","YMAB","AOMR","DHY","EARN","EVM","CIO","ZUMZ","MBI","SGHT","MFIN","WHF","FLD","ARQ","SDSYA","SLND","MVT","PVBC","KINS","EXFY","TE","EMF","RGCO","INBX","SCPH","MPAA","DENN","FSTR","BETR","JILL","MUE","BWAY","MHI","AFRI","MNPR","PMF","IMAB","BPRN","FVCB","COSO","LCNB","GENC","CFFI","SSTI","WOLF","CRGX","GBUX","TMQ","EACO","IDR","MPV","CRNT","INSE","GLATF","TLS","MIO","KOD","HWBK","DOYU","PNPNF","OMER","TBI","OPP","MYFW","MAV","ETX","RBTK","TLSI","PRQR","UMAC","HLSCF","VABK","FRGE","UNG","PROF","DBB","RDCM","EHI","PCOK","GPJA","DRUG","PAL","SANG","ACIU","CRML","ESCA","EVC","FORR","THM","SDM","SKIN","SLAMF","WIA","NLST","WNEB","BTMD","FINW","BLFY","SUPX","SIEB","UHG","DSX","FT","ZVIA","PRME","GF","OGI","NEGG","ESSA","IONR","LCTX","PHCI","BHR","FUNC","HFFG","MRT","PESI","VOXR","HITI","USAU","NTWO","CDXS","BSL","ATHR","PERF","DMB","BKN","SRV","TLSA","INMB","NXG","INVZ","DHF","ELLO","NPWR","REI","VYGR","NVX","VTYX","ALMU","FSP","RGP","STXS","EP","ZNOG","VRNOF","NVCT","CIA","IPHA","UTMD","FEIM","SSGC","JYNT","OPBK","HPAI","LRMR","VBF","ALTS","ESOA","NXDT","SWKH","CRLBF","VPV","CYBN","FCCO","FLC","SEVN","CFNB","FSFG","SSSS","CRAWA","ELDN","FXNC","IDE","FCCN","PCK","ENJ","ACTU","PROP","INGN","BXSY","DYNX","RAIL","NA","AVR","ELMD","RANG","BEEP","VXRT","PBYI","RCMT","ENGN","POWW","NKSH","CBNA","ATOM","EGAN","SRG","ENX","BZUN","PHX","IBAC","BOOM","THSGF","ARBE","EDIT","OCCI","CLPR","SCTH","OXSQ","TOYO","TAVI","BIOA","SLS","CCFN","LARK","SMRT","SPE","ENTA","SMHI","COE","PIM","GAUZ","EFSI","AENT","PLG","RCKY","PCQ","ACRS","DERM","ATLN","NB","TEAF","FFMGF","FRAF","MSD","SRI","PRMLF","SPRO","AZULQ","STRS","RFAI","FNRN","CIK","FCAP","GGAZF","DMAC","SNBR","FLXS","ANIK","WFF","NRO","SORA","ATLO","BGX","ESGH","LFVN","RENEF","HNVR","RPID","BKTI","SPWH","CVRX","TNYZF","NNY","XGN","OVBC","CGEN","IGA","CFBK","BVFL","SPWR","ELA","EDF","REKR","CLLS","MHF","SMID","CXDO","ALEC","GLDG","LDDD","NFTN","AISP","UBFO","CHMX","VGAS","LNSR","HAIN","FATE","TGEN","VTN","FFAI","MIMI","EVG","GRX","LAZR","LYEL","PEBK","AOUT","ZTEK","ACU","BTM","CHGG","ALYAF","DCGO","MRCC","RMBI","MED","RCEL","DMF","MRBK","WHG","PFD","ISPR","SITKF","MDV","ICTSF","CMT","AEYE","MOLN","BARK","KYTX","VRM","CZWI","BSET","IKT","LUCD","MX","AMPY","BRLT","MATH","EPRX","HQI","RAPT","TZOO","SKIL","PZC","MPA","FLYY","PPIH","ECBK","VRSSF","RBKB","ELVA","SHIP","GOCO","BWG","MFGCF","SVCO","LAKE","NMRA","LFT","SAMG","ECF","PYYX","DMO","CLAR","NRGV","EDHL","MPTI","NAZ","EUDA","ACR","DLNG","BCBP","GENK","PLL","GGT","TUSK","ASMB","PTNM","MCN","PDEX","FXY","TRUE","DBE","NKTX","INFU","LXEO","FTLF","VNTG","MRAM","CAAS","SKYX","EBMT","JHS","WLAC","CHN","AKA","ULBI","WEA","ZENA","HEQ","GECC","GPRO","BHST","QNBC","VIRC","KRRO","FNWD","ARAY","GAIA","DHX","ESGL","IBATF","GLSI","CUPR","TSE","USGO","CCIF","ABAT","TARA","KVAC","VFF","PHD","CMCM","OWLT","MB","PLX","BTA","EMYB","RMMZ","AVD","BRCC","OFS","FNGR","ACNT","OCG","OBIO","SVT","IH","VFL","CCCC","GNLX","PCF","GPMT","PFO","SGMO","SBFG","CSPI","VLDX","PAI","SFBC","BMOOF","PCSC","YSXT","PDCC","NTHI","RRACF","FATN","UTGN","GEVI","FRD","FREVS","NCTY","IMPP","AFBI","SVII","CSBB","ESP","QSEA","THTX","SHMD","RVSB","CTNM","AXR","TAYD","CWGL","TSQ","AIFE","GFLT","ACHV","FGFH","CGO","LGDTF","LODE","NIM","LGCY","ICG","TWIN","SUAC","CXE","FLL","GIFI","BUKS","NMT","ILLR","TGMPF","CRGO","VRDR","HURA","AFCG","CRBP","HOFT","CMTV","ZJYL","AXREF","NKTR","DBI","CBAT","AMWL","ONL","KEQU","BRLS","EXOZ","AMTX","BCV","BYSI","BW","PTMN","CTOR","WHEN","ATOS","GNT","STKS","INSG","SBI","ASPS","TOUR","TDRRF","KF","KVHI","HUHU","LTCN","GGZ","HANNF","LQMT","HNW","LUD","BEOB","CVVUF","GUTS","CRBU","CTM","KISB","BCHG","IHD","ATEK","GLU","WGRX","PHOE","FGMC","LVPA","CSBR","QH","JEQ","NWPN","MGF","ERH","NEOV","JLS","FGBI","HMR","CPKF","WBX","BAER","AXTI","IRBT","DSAQ","QSEP","SKLZ","RAYA","NNBR","HAFG","MDXH","KNDI","CHMI","IGI","CEE","NMI","PSQH","TRX","DIBS","PFX","OKYO","TROO","TNYA","GLACF","HURC","CABA","ZNTL","COYA","STEC","VIOT","MGRM","PBHC","NCT","SLNG","SNT","HLVX","IVVD","SFDL","FTRK","PRE","UEIC","IROH","BSBK","UFI","PGP","WHWK","PPCB","BYNO","HSPT","GDL","RSSS","FSHP","SRL","ADAG","NOBH","FONR","LTRX","PUCK","ANLDF","LSBK","SWIN","ENTX","QUIK","BMEA","VERU","XTNT","ITMSF","DUOT","FURY","SLBK","PLMJF","BHLL","TSNDF","ALTO","OLKR","PPYA","PNBK","VMCAF","ASST","RILY","DIST","CHRS","AMRRY","SOL","BCRD","CODA","IXAQF","OPTT","IOBT","NAUT","TISI","PLCE","MIST","INTT","BKRRF","KBLB","GORO","VGI","ORMP","QIPT","GDO","MCRP","GSVRF","LSE","NIPG","RRGB","TCRX","MAMO","WRAP","CPHC","NAMI","GALT","ZSPC","FCO","ISRL","GMHS","MBOT","CLYM","SILC","KUKE","BIRD","HNNA","KBSX","GRUSF","LCUT","STLRF","WSBK","DGXX","JVSA","VEEA","MTEN","AIRRF","MCHX","BKKT","ODYS","JSPR","SWZ","ASFH","NXC","SFWL","LGO","UNCY","NOTE","SRZN","INCR","FNMCF","BZFD","OSS","FEAM","CAPN","COLA","YHNA","CNDA","ATPC","PDSB","NTRB","UFG","MTWO","GGROU","SRTS","USEG","CDLX","XBIT","FBRX","TGLO","EURK","CPIX","SGA","COPR","HYMC","DTF","RDZN","DLHC","ELUT","FVN","GCTS","IMUX","UNIB","GSIT","DMA","NCSM","BMGL","IROQ","AOGO","ZENV","OTLK","UCL","MHH","UBCP","NVNO","RVLGF","LUCN","METXF","NOTV","RDAC","SNCR","RSKIA","PRPL","RFL","AUBN","NUKK","STEM","APGOF","UYSC","STG","PCM","OCX","RGT","FTCO","PN","WYHG","GGR","MAYS","XCH","FNWB","INDO","LVO","PNI","ZURA","RCON","FMBM","ALAR","PETS","EPIX","GCV","IVFH","INVE","CBUS","INO","TYGO","PED","DYCQ","FOSL","AEAE","WKEY","LOOP","CSLMF","IGMS","DOMH","VATE","IVCAF","GRO","BRID","NSPR","UURAF","XTGRF","KANP","HGBL","DWNX","PGZ","AURX","GLXZ","YIBO","VLT","MLSS","RPMT","NVA","GRWG","ARMP","TZUP","GNSS","SNTI","TELA","AREC","ALOT","VANI","VTSI","LONCF","IMRX","RCT","AFJK","GRYP","GMM","NTIC","MSCLF","CTSO","MVO","CEV","PYRGF","STRO","NMS","FDSB","ATHE","MDIA","IKNA","ANRO","CCG","IMMX","MNOV","UBXG","QNCX","VNRX","BOTJ","ADAP","NSTS","NORD","GTII","ABOS","TGAAF","PLNH","HYDTF","PMVC","EDAP","TRBRF","HLP","SELF","ORGN","APYX","LNZA","SKYE","SERA","VERI","DIT","GCUMF","ZYXI","VTGN","UWHR","FTZFF","REFR","JUVF","JG","SSVFF","RPTX","OAKU","GOAI","KIDZ","AP","CAHO","CXH","CBKM","CLSD","BAFN","AKYA","FORA","CRVO","CERO","WETO","ASYS","AAWH","RENB","FBSI","MCTR","NEUE","CDIX","ASRT","CATO","GLAI","GEG","BLGO","CNVS","CRT","ORRCF","QNTM","DXLG","AUGG","YYGH","PVL","CSTE","ANL","FTCI","YCQH","BTOC","BAYA","ATRA","BRIA","PAVS","LOAN","AUID","JMM","MDNC","SACH","MSW","YTRA","VRCA","SHIM","AZI","NRXP","CPBI","ICCM","XTRAF","VNJA","TELO","ICCC","CMTL","CDAQF","MAQC","SPAUF","NUVR","ABVE","XPL","FTEK","HYPR","BYFC","PMVP","CNTX","HHLKF","APXIF","RGS","VVPR","XCUR","RDGL","FBIO","BDL","KOOYF","HOVR","CLRCF","ABLV","HOWL","KLTO","NRSN","FSXLF","DMYY","ANEB","PNF","EMCG","TPIC","ANVS","KRON","NHTC","FSI","AASP","BEDU","DTIL","PRLD","HTLM","MAIA","ONCY","SURG","GVXXF","LINK","JUSHF","ELPW","WFCF","MGX","SCWO","AVTX","TBMC","EDVR","GANX","FMFG","SMXT","FSEA","DVLT","AIJTY","ALCY","ESAUF","BEAT","OPHC","CNTB","YXT","BHM","CHEV","CRCUF","MAXN","SNTL","IFRX","MDAI","INLX","APLT","CLST","FNVTF","BCHT","TSKFF","OSTX","SUUN","ADVM","APT","HSPO","FMY","INUV","VRA","FTII","BMR","USPCY","SYHBF","OPTX","OPGN","LEAT","SELX","UPLD","ONEG","IPSC","HLEO","NRT","SYPR","AIRT","PRT","CJET","STTK","PODC","RSF","ISPO","BIOF","TMRC","BEWFF","WELNF","VOC","SXTC","KRYXF","RBOT","TCBS","AIRG","MIND","PSRHF","HCMC","CULP","GLABF","ARTV","SVRSF","RNXT","WPRT","TETEF","BRFH","AGFY","ALGS","IZEA","SQNS","PRTS","ASRV","FKWL","KLXE","KLRS","CUE","TOP","MKTW","ATNM","CVGI","SNNGF","MDWK","GROV","FORL","VSME","ETST","PEPG","BTCS","RAND","FAT","MIFF","MDBH","LRFC","SPAI","DBGI","LCGMF","ACCS","MRSN","ATMV","ZLSCF","JFB","MXE","KPLT","NXN","LGCL","YOTA","KOSS","MFI","SPCB","ACFN","AVNI","MSSAF","DXR","CCTSF","ESHA","RFIL","HOUR","GLLI","MYND","MODV","PZG","SNAL","ZOMDF","WWR","NTZ","RDI","BGSF","SEOVF","RBNE","MODD","TECTP","HFBL","MURA","TORO","CETI","DWSN","ACKRF","AWCA","AMPG","FLYE","BDSX","SWVL","GIFT","CELU","BLIV","MKDW","VIVK","SKKY","MDCX","ROMA","RADX","SRFM","CCEL","GDC","QRHC","GDST","BRZH","CIIT","LEE","NEPH","KORE","BWEN","ICMB","ATMC","VTVT","TETOD","BNR","PMEC","AGXPF","WTMA","KACLF","QETA","HKIT","HNOI","ZDGE","ITRM","JRSH","INTZ","USGDF","GRCE","TURN","WINV","CAPT","FMST","ARSMF","TOON","QZMRF","DYNR","FAAS","AIFF","CUBA","GRF","WSTRF","PBBK","KSCP","UONE","MESA","JANL","IGTA","CPSH","IPWR","MASK","FLNT","CHNR","BBBXF","ECOR","WBQNL","LXEH","ACRV","JETMF","LGL","UG","SJ","TMDE","MGLD","AAME","AWRE","LIVE","HCAI","CLNN","TMGI","REED","POCI","DSWL","GLGI","NDLS","FUEMF","BRNS","OKUR","NIXX","TLYS","KPEA","ARKR","CUAUF","VHC","OMEX","PRKR","FOXX","AKTX","ENGS","MOBQ","TWOH","KITT","AHT","APWC","TACT","ESLA","CREX","SNTW","MOBX","MNY","BCG","PYPD","XBP","LVTX","RAVE","PLUR","JUNS","WAVE","GTEC","CGTL","OMCC","AXIL","RNLXY","XLO","RVPH","GSIW","NVNI","UNXP","ALSAF","FTHM","PGZFF","SPRU","IQST","NTWK","IPA","INIKF","WNLV","LTRN","MMCP","HIT","BTCM","LASE","DDC","KTCC","MPU","INTE","MCAG","NSFDF","RMTI","SFCO","ANTX","ANGH","NZAUF","CNF","CISO","FARM","PLUT","CSAI","SFRX","CRWS","SDST","TPCS","OCLN","SODI","SCYX","ZBAO","DRIO","QVCGA","CLIR","RANI","NINE","GROW","CAMP","POWMF","CIF","FBLG","HHS","UEEC","GWTI","BOWN","SAGT","TOPP","PXS","CBSTF","PGDE","FPAY","MOGO","GAME","ABVC","ENZB","RVRC","PYN","DNQAF","RGCCF","AUSI","SMOFF","PPSI","LBGJ","TTIPF","DRYGF","WYY","CASI","LILMF","COEP","TRSG","EZOO","HSTC","ZCMD","MBBC","CENN","NGLD","PFAI","BNIX","INKT","COCH","FEMY","STCB","RTTGF","PULM","OHCFF","CCM","LTRY","DYAI","INIS","IMNN","WVVI","MNDO","MMTIF","JUPGF","ARBK","SIDU","BONXF","CHEB","VRAR","NMTC","ZONE","IZM","QNTO","MHUBF","IEGCF","CHUC","GNS","VLTLF","UMEWF","ALXO","SWAG","CVKD","MLEC","MRMD","NVLHF","KALA","BGFV","HTCO","DARE","OSRH","SCLX","KIRK","BOSC","BODI","GLBS","ITHUF","GORV","RETO","MWYN","OPAD","RAIN","FGEN","CLPS","SCOR","LITM","NTRP","IPM","ENMI","PRKA","HRBR","FLUX","CRMZ","CPPMF","FCCI","CRIS","NWGL","TLF","BATL","AQUC","GNRV","HUSA","AACG","PXLW","WAMFF","NFUNF","NSYS","TURB","FCUV","XTIA","TNMG","ABCP","GBIO","PASG","WOK","EDRY","DTST","BCAB","FENG","GLE","RSRV","XOS","SRLZF","NYC","AIXI","HRGN","NKGN","GDTC","AZASF","PAYD","TPST","SGRP","IGC","NOM","INTG","CALC","ADD","NNVC","KNW","GVH","NEUP","KDOZF","MTC","EPOW","CLOQ","MTEK","BOLD","VEXTF","TBTC","HSON","SRM","MXC","TRT","TENX","EHGO","CTRM","BANL","JVA","RLMD","VIPZ","PRZO","WTHVF","HUBC","AAUAF","CNFN","EBON","PSHG","VPLM","LOCL","MSAI","CMMB","WIMI","VTYB","LRE","SIF","YOSH","LGPS","NCEW","VOR","PHNMF","XTKG","ZDAI","STAK","NRDE","ELEV","KENS","HBIO","LITB","STRM","NEWH","ROLR","AIRE","OCC","JYD","JSDA","RENT","GDHG","TOMZ","AITX","WPGCF","ZEFIF","GFAI","HOLO","BCTX","AUST","MFON","ENLV","FGF","QTIH","VWFB","BDCO","ANTE","IEHC","VAUCF","DALN","HUIZ","CKX","ARTL","COOT","OFAL","NAII","CVV","VASO","SLGL","CJMB","MLGO","VCUFF","LSTA","BIVI","YTFD","JOB","YHGJ","MRAI","EMGDF","MIRA","UTSI","DTCK","KLNG","FEDU","DXST","NNUP","IPW","ROMJF","IHT","MILIF","NXGL","HXHX","KFFB","FDCT","KNGRF","QTTB","SPND","OTLC","LEDS","ADVB","AYRWF","SOND","RVP","OVID","GYRO","AGSS","CURR","CXAI","DRRX","JGLDF","RAY","GNOLF","WGHTQ","LGVN","BTCT","BOF","HGTXU","HUDI","RNGE","IXHL","ZCRMD","CBIO","NXL","SNNF","JBDI","FGL","LRDC","LVLU","NXTC","ORIS","USIC","IMTCF","ELBM","MOB","CHKR","LEXX","INVU","OESX","CLRB","MGRX","EMUSF","BLTH","STAI","CGTX","BLIN","SGLA","VNCE","IINN","ALUR","BLBX","AUIAF","LGCXF","RCG","REE","EHLD","NXPL","SMSI","JL","KCCFF","EQS","CLGN","MRKR","HKPD","SGMA","SNYR","SHOT","PFSB","MGIH","UAVS","PLAG","YQ","AAQL","SOS","EVAX","MTEX","ANY","HOTH","ASBP","CING","SABOF","BFNH","GTIM","CXXIF","RVSN","QYOUF","DPRO","RKHNF","LSB","BRGC","MSS","ADGM","BRN","HOOK","CETY","BLRX","LPTX","NVFY","MOGU","EQTRF","LPCN","ACUT","BGI","PMN","RMCO","NISN","COHN","JPOTF","PRPO","GEDC","CRWE","VSEE","ENFY","XFOR","AMOD","FLGC","SKYQ","TDTH","DTSS","SABS","JZXN","BURU","JFU","BHV","BNAI","CLNV","LUDG","IRIX","BFRG","GIGM","WNDW","PCSV","KDKGF","GOVX","OPI","MDRR","WKSP","PETV","GTHP","ESHSF","ILAL","STFS","USEA","LIDR","EDTK","AMS","CWBHF","COCP","SIREF","XAIR","RMSL","WXM","ECRO","TKLF","HIGR","LYRA","PBMLF","BPT","SUND","MEIP","PUBC","VYNE","WRPT","CCTC","MAPPF","MSBB","BKUCF","PGFF","UCAR","SYBX","STLY","ATBHF","QMCI","XIN","PT","NCRA","XHLD","WAI","DQWS","CANF","LIQT","MSGM","LSPKF","PREM","TXMD","TRXA","UBX","RLYB","PRPH","IONI","IRVRF","DUKR","IMG","SCNX","LNBY","YYAI","GOVB","CFOO","CSRIF","EDSA","AMST","PLCKF","GLBZ","COSM","CVR","ZEOX","CREG","JCTC","TIRX","MYNAY","SRRE","OXBR","AIRI","DEMRF","GWH","INLF","LRRIF","ICU","GRNQ","BTCY","EPWK","KZIA","TAIT","MMA","BRGX","ABP","INBS","ACPS","CCTG","BREA","IVDN","DLPN","BRTX","LPSIF","GEBRF","REBN","SYNX","MRM","ALLR","PFHO","EQ","GUER","SAIH","NCL","MTR","VCIG","CYCU","VVOS","SPRS","TRIB","ATHA","BNGO","ZOOZ","MSPR","SANW","LFWD","PWM","EDUC","STSBF","PNTZF","AYTU","BOLT","CBLO","LIPO","HLGN","GP","ZKIN","MKZR","AGMRF","UPYY","FEBO","LDDFF","WETH","GWAV","SKK","HTCR","INEO","BCDA","KSEZ","PC","ORKT","CVM","MCVT","CSCI","AREB","EONR","PBSV","CLIK","RYES","LBCMF","SDCH","CLEV","ECDA","APAAF","BIYA","BNZI","GTI","FRSX","KRKR","SUP","PETZ","DEVS","TPET","ATER","SYTA","AIMD","HCWB","APCX","DRCT","MI","PHIO","CLDI","GPUSF","DATS","PAIYY","MAAS","PURE","CMRZF","DWIS","PHGE","TIKK","WCT","DHAI","NLSP","MHUA","ASPZ","INTJ","EXDW","PSTV","ONMD","PRTG","XTLB","APRE","CDTG","LNTO","ORGS","AEON","ABTS","IMRN","JXG","PXPC","ILAG","VERB","DROR","BHSIF","SONM","SDOT","GNLN","BMNR","PEVM","TLPH","CPOP","EFOI","SEVCF","FTSP","ADXN","BIXT","SPPL","CYCN","TCRI","MARPS","AEI","BTAI","GPUS","KXIN","QURT","BNET","EEIQ","BETRF","CLRO","OMH","RITE","ASTC","ALRTF","GPMTF","CYCC","CIGL","IOTR","ELECF","TRAW","FTEL","SSKN","SCND","PSIG","SCKT","WKHS","LEVGQ","AWX","MWG","GRHI","CEIN","ARTW","FNFI","RMCF","VRME","KPRX","VYND","JTAI","UECXF","CMBM","EKSO","DWTX","MBRX","BMNM","YBGJ","BON","RLBY","SLTN","GXAI","MCUJF","CLWT","MFBI","MSN","VMAR","DTCB","LDWY","LCTC","CTXR","XERI","RLYGF","FBGL","GLXG","FXBY","HCTI","KAPA","FRECF","DSS","SNBH","SOWG","PCMC","OP","BLMH","LMFA","BASA","TRUG","ELVG","EJH","XCRT","AGH","SOGP","BMRA","STME","VERTF","SVBL","HMBL","SINT","SLXN","TESI","HWH","IMCC","CRVW","CNEY","APM","NMREF","SEED","NKLAQ","TSBX","LIMX","CARV","GURE","TBH","HIHO","INAB","HCWC","LUCY","CYN","GIPR","HTOO","JZ","GV","AHNRF","BIAF","SNSE","TINFF","CVAT","RDGA","CRCE","SUGP","AITTF","DUO","JDZG","YCBD","TWG","MNTS","ZCAR","APLM","RIME","MMTRS","ZBAI","LNKS","ACXP","AMBO","FORD","PMAX","GTBP","SBFM","TRBMF","SHFS","LDTC","CMCT","NCI","PKKFF","UUU","HVGDF","ZTSTF","MYNZ","NWTG","NITO","EYEN","TRNR","GULTU","WAST","BQ","PMCB","LSH","RKDA","CYCA","BNRG","KWIK","TNON","CRYM","SSY","CDIO","AQMS","SISI","ENZN","CRGH","PTLE","EWSB","CBIH","SRXH","AIM","STRR","IMTH","PPBT","RDGT","ADN","CPIVF","XYLO","SNES","SOPA","AAMTF","TRRFF","KAVL","PTOP","HYEX","WAFU","FFLO","PET","LILIF","ASNS","HGGCF","OTRK","KIQSF","CHSN","ZDPY","BFRI","FGI","EATBF","SPHL","ICON","BABB","HLRTF","VXTRF","GSUN","BLNE","JCSE","SNGX","LGCB","ELWS","HOFV","BCUFF","PRSO","KTTA","VIPRF","VIZNF","TTNP","LIFD","RVYL","FDXTF","BICX","INTS","OLB","NCPL","ALBT","SPFX","GBR","CLSH","RNAZ","ONAR","STSS","ATNF","CELZ","IRME","DSNY","RSMXF","BMTM","IBG","GPOX","ADIA","SQFT","NUGN","CVSI","SNPX","MITQ","INDP","FTFT","ULY","IBO","SUNE","IVDA","SRNW","TRCK","URZEF","GLNS","BDRX","CRKN","RYDE","LOBO","NMEX","TWOSF","CPHI","MBIO","SNTG","STTDF","WNW","AGMH","FRGT","REDRF","INHD","AIEV","BGLC","TCRT","FGNV","LTUM","ONFO","BMXI","NUMD","OBLG","HLYK","BBLR","KLYG","ENSC","WHLT","SOBR","LVRLF","VEEE","SNOA","NVVE","WBUY","CWD","QNRX","BZYR","XWEL","AIHS"
]

# === Get Last Valid Trading Day ===
def get_last_trading_day():
    today = datetime.today()
    if today.weekday() == 5:  # Saturday
        return today - timedelta(days=1)  # Friday
    elif today.weekday() == 6:  # Sunday
        return today - timedelta(days=2)  # Friday
    else:
        return today

last_trading_day = get_last_trading_day()
start_date = "2025-04-01" #last_trading_day.strftime("%Y-%m-%d")
end_date = "2025-06-20"#(last_trading_day + timedelta(days=1)).strftime("%Y-%m-%d")


# === Prepare DB ===
os.makedirs("sweden/data", exist_ok=True)
conn = sqlite3.connect(DB_PATH)

with conn:
    conn.execute("""
        CREATE TABLE IF NOT EXISTS equities_full (
            name TEXT,
            date TEXT,
            open REAL,
            high REAL,
            low REAL,
            close REAL,
            volume INTEGER,
            PRIMARY KEY (name, date)
        )
    """)

# === Main Loop ===
all_data = []

for ticker in TICKERS:
    try:
        print(f"[+] Downloading {ticker} from Yahoo Finance...")
        df = yf.download(ticker, start=start_date, end=end_date, interval="1d", auto_adjust=True)

        if df.empty:
            with open("failed_tickers.txt", "a") as f:
                    f.write(f"{ticker}\n")
            print(f"[!] No data for {ticker}")
            continue
    except Exception:
        with open("failed_tickers.txt", "a") as f:
            f.write(f"{ticker}\n")
        continue
            

    df.reset_index(inplace=True)
    df["name"] = ticker
    df["date"] = pd.to_datetime(df["Date"]).dt.strftime("%Y-%m-%d")
    df = df[["name", "date", "Open", "High", "Low", "Close", "Volume"]]
    df.columns = ["name", "date", "open", "high", "low", "close", "volume"]
    df = df.dropna()

    all_data.append(df)

# === Insert to DB
if all_data:
    combined = pd.concat(all_data, ignore_index=True)
    combined["date"] = pd.to_datetime(combined["date"]).dt.strftime("%Y-%m-%d")
    combined = combined.drop_duplicates(subset=["name", "date"])

    with conn:
        # Delete just for this scraped date
        for d in combined["date"].unique():
            conn.execute("DELETE FROM equities WHERE date = ?", (d,))
        combined.to_sql("equities", conn, if_exists="append", index=False)

    print(f"[✓] Stored {len(combined)} total rows for {len(TICKERS)} tickers.")
    print(f"[✓] Inserted {len(combined)} rows into 'equities' table.")
    print(f"[✓] Done for {start_date}")
else:
    print("[x] No data to insert.")

conn.close()